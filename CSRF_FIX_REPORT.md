# ุชูุฑูุฑ ุฅุตูุงุญ ูุดููุฉ CSRF ูุญูุงูุฉ ุงูููุงุฐุฌ ๐ก๏ธ

## ููุฎุต ุงูุฅูุฌุงุฒ
ุชู ุฅุฌุฑุงุก ูุญุต ุดุงูู ูุฅุตูุงุญ ุฌุฐุฑู ููุดููุฉ `CSRF Token Error (403 Forbidden)` ุงูุชู ูุงูุช ุชูุงุฌู ุงููุณุชุฎุฏููู ุนูุฏ ุฅุฑุณุงู ุงูููุงุฐุฌ. ุงูุชุนุฏููุงุช ุดููุช ุฌููุน ุงูุฑุชุจ (Super Admin, School Admin, Teacher, Attendance) ูุฌููุน ุฃููุงุน ุงูููุงุฐุฌ (Standard Forms & AJAX).

## ุงูุชุนุฏููุงุช ุงูุชูููุฉ ๐๏ธ

### 1. ุงูู Backend (app.js & Middleware)
- **Global CSRF Injection**: ุชู ุงูุชุฃูุฏ ูู ุชูุฑูุฑ `csrfToken` ููู ุงูู Views ุนุจุฑ `res.locals`.
- **Global Availability**: ุชู ุงูุชุฃูุฏ ูู ุฃู ููุชุจุฉ `csurf` ุชุนูู ุจุนุฏ `cookie-parser` ู `session` ูุถูุงู ูุฑุงุกุฉ ุงูููููุฒ ุจุดูู ุตุญูุญ.

### 2. ุงูู Frontend (Global Header)
- ุชูุช ุฅุถุงูุฉ `Hidden Input` ูุญูู ูููุฉ ุงูุชููู ูู ุงูู **Header** ุงูุฑุฆูุณู (`views/partials/header.ejs`).
- **ุงูููุฒุฉ**: ูุฐุง ูุฌุนู `csrfToken` ูุชุงุญุงู ูุฃู ููุฏ JavaScript ูู ุฃู ุตูุญุฉ ุนุจุฑ:
  ```javascript
  document.getElementById('csrfToken').value
  ```

### 3. ุงูููุงุฐุฌ ุงูุชูููุฏูุฉ (Standard Forms)
- ุชู ุญูู ุงูุนูุตุฑ ุงูุชุงูู ูู **ูู** ูููุฐุฌ `<form>` ูู ุงููุดุฑูุน ุชููุงุฆูุงู:
  ```html
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
  ```
- **ุนุฏุฏ ุงูููุงุฐุฌ ุงููุตุญุญุฉ**: ุชูุฑูุจุงู 30 ูููุฐุฌุงู ููุฒุนุฉ ุนูู ูููุงุช ุงููุดุฑูุน.

### 4. ุทูุจุงุช AJAX (Fetch Calls)
- ุชู ุชุญุฏูุซ ุฌููุน ุงุณุชุฏุนุงุกุงุช `fetch` ุงูุชู ุชุฑุณู ุจูุงูุงุช (`POST`, `PUT`, `DELETE`).
- ุชูุช ุฅุถุงูุฉ ุงูู Header ุงูุชุงูู ููู ุทูุจ:
  ```javascript
  headers: {
      'Content-Type': 'application/json',
      'CSRF-Token': document.getElementById('csrfToken').value
  }
  ```
- **ุนุฏุฏ ุงูุทูุจุงุช ุงููุตุญุญุฉ**: ุชูุฑูุจุงู 40 ุทูุจ Fetch.

## ุงูุงุฎุชุจุงุฑ ูุงูุชุญูู โ
- **ุชุณุฌูู ุงูุฏุฎูู/ุงูุฎุฑูุฌ**: ูุนูู ุจูุฌุงุญ (ูุญูู).
- **ุฅุถุงูุฉ ูุฏุฑุณุฉ (Super Admin)**: ูููุฐุฌ AJAX ุงููุนูุฏ ูุนูู ุจูุฌุงุญ.
- **ุฅุฏุงุฑุฉ ุงูุทูุงุจ ูุงููุนูููู (School Admin)**: ุชุนูู ุจูุฌุงุญ.
- **ุฑุตุฏ ุงูุฏุฑุฌุงุช (Teacher)**: ูุนูู ุจูุฌุงุญ.

## ููุงุญุธุงุช ูููุทูุฑ ๐
- **try/catch**: ูุนุธู ุงุณุชุฏุนุงุกุงุช ุงูู Fetch ุชุญุชูู ุนูู ูุนุงูุฌุฉ ููุฃุฎุทุงุก. ูููุตุญ ุนูุฏ ูุชุงุจุฉ ุฃู ููุฏ ุฌุฏูุฏ ุจูุณุฎ ุงูููุท ุงููุชุจุน ูุถูุงู ุงุณุชูุฑุงุฑ ุงููุงุฌูุฉ.
- **Form IDs**: ูุธุฑูุง ูุฃููุง ุฃุถููุง `id="csrfToken"` ูู ุงูููุฏุฑุ ุชุฌูุจ ุงุณุชุฎุฏุงู ููุณ ุงูู ID ูู ุนูุงุตุฑ ุฃุฎุฑู ุฏุงุฎู ุงูุตูุญุงุช ุงููุฑุนูุฉ ูุชุฌูุจ ุงูุชุนุงุฑุถ.

ุงููุดุฑูุน ุงูุขู ุขูู ุชูุงูุงู ุถุฏ ูุฌูุงุช CSRF ูุฌุงูุฒ ููุงุณุชุฎุฏุงู. ๐
