<%- include('../../partials/head.ejs') %>
<body class="rtl">
<div class="bmd-layout-container bmd-drawer-f-l avam-container animated bmd-drawer-in">
  <%- include('../../partials/header.ejs') %>
  <div id="dw-s1" class="bmd-layout-drawer bg-faded">
    <%- include('../../partials/sidebar/index.ejs') %>
  </div>

  <main class="bmd-layout-content">
    <div class="container-fluid">

      <div class="row m-1 pb-4 mb-3">
        <div class="col-12 p-2">
          <div class="page-header breadcrumb-header">
            <div class="row align-items-end">
              <div class="col-lg-8">
                <h3 class="lite-text">إضافة صادر جديد</h3>
                <span class="lite-text text-gray">أدخل بيانات الصادر الجديد</span>
              </div>
              <div class="col-lg-4 text-left">
                <a href="/school-admin/expenses" class="btn btn-secondary">
                  <i class="fas fa-arrow-left"></i> العودة للصادرات
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row m-1">
        <div class="col-12 p-2">
          <div class="card shade h-100">
            <div class="card-body">
              <form id="addExpenseForm" class="text-right">
                <div class="form-group">
                  <label>المبلغ *</label>
                  <input type="number" name="amount" class="form-control" required>
                </div>
                <div class="form-group">
                  <label>الفئة</label>
                  <input type="text" name="category" class="form-control">
                </div>
                <div class="form-group">
                  <label>الوصف</label>
                  <textarea name="description" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn btn-success">إضافة الصادر</button>
                <a href="/school-admin/expenses" class="btn btn-secondary">إلغاء</a>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<%- include('../../partials/scripts.ejs') %>
<script>
  const form = document.getElementById('addExpenseForm');
  form.addEventListener('submit', async e => {
    e.preventDefault();
    const formData = {
      amount: form.amount.value,
      category: form.category.value,
      description: form.description.value
    };
    try {
      const res = await fetch('/school-admin/expenses/create', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(formData)
      });
      const data = await res.json();
      if(data.errors) {
        if(data.errors.general) alert(data.errors.general);
      } else if(data.success) {
        alert(data.success);
        if(data.redirect) window.location.href = data.redirect;
      }
    } catch(err) {
      alert("حدث خطأ أثناء الإرسال");
      console.error(err);
    }
  });
</script>
</body>
