<%- include('../../../partials/head.ejs') %>
<body class="rtl">
<div class="bmd-layout-container bmd-drawer-f-l avam-container animated bmd-drawer-in">
  <%- include('../../../partials/header.ejs') %>
  <div id="dw-s1" class="bmd-layout-drawer bg-faded">
    <%- include('../../../partials/sidebar/index.ejs') %>
  </div>

  <main class="bmd-layout-content">
    <div class="container-fluid">
      <h3>إضافة صادر جديد</h3>

      <form id="addExpenseForm" class="text-right">
        <input type="hidden" name="_csrf" id="csrfToken" value="<%= csrfToken %>">
        <div class="form-group">
          <label>اختر المدرسة *</label>
          <select name="schoolId" class="form-control" required>
            <% schools.forEach(school => { %>
              <option value="<%= school._id %>"><%= school.name %></option>
            <% }) %>
          </select>
        </div>

        <div class="form-group">
          <label>المبلغ *</label>
          <input type="number" name="amount" class="form-control" required>
        </div>

        <div class="form-group">
          <label>الفئة</label>
          <input type="text" name="category" class="form-control">
        </div>

        <div class="form-group">
          <label>الوصف</label>
          <textarea name="description" class="form-control"></textarea>
        </div>

        <button type="submit" class="btn btn-success">إضافة الصادر</button>
      </form>
    </div>
  </main>
</div>

<%- include('../../../partials/scripts.ejs') %>

<script>
const csrfToken = document.getElementById('csrfToken').value;
document.getElementById('addExpenseForm').addEventListener('submit', async e => {
  e.preventDefault();
  const formData = Object.fromEntries(new FormData(e.target).entries());
  const res = await fetch('/super-admin/expenses/create', {
    method: 'POST',
    headers: {'Content-Type': 'application/json', 'CSRF-Token': csrfToken},
    body: JSON.stringify(formData)
  });
  const data = await res.json();
  if(data.success) window.location.href = data.redirect;
  if(data.errors) alert(data.errors.general);
});
</script>
</body>
