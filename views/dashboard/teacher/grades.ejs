<%- include('../../partials/head.ejs') %>

<body class="rtl">

<div class="bmd-layout-container bmd-drawer-f-l avam-container animated bmd-drawer-in">

  <%- include('../../partials/header.ejs') %>
  <div id="dw-s1" class="bmd-layout-drawer bg-faded">
    <%- include('../../partials/sidebar/index.ejs') %>
  </div>

<main class="bmd-layout-content">
  <div class="container-fluid">
        <input type="hidden" name="_csrf" id="csrfToken" value="<%= csrfToken %>">
         <!-- Flash messages -->
                <% if (locals.success && locals.success.length > 0) { %>
                  <div class="alert alert-success"><%= success %></div>
                <% } %>
                <% if (locals.error && locals.error.length > 0) { %>
                  <div class="alert alert-danger"><%= error %></div>
                <% } %>


<h3>رصد الدرجات – <%= exam.title %></h3>

<form id="gradesForm">
  <div class="table-responsive">
<table class="table table-bordered text-center">
<thead>
<tr>
  <th>#</th>
  <th>اسم الطالب</th>
  <th>الدرجة</th>
  <th>ملاحظات</th>
</tr>
</thead>
<tbody>
<% students.forEach((s,i) => { %>
<tr>
  <td><%= i+1 %></td>
  <td><%= s.fullName %></td>
  <td>
    <input type="number"
      class="form-control"
      name="score_<%= s._id %>"
      value="<%= s.score ?? '' %>"
      min="0">
  </td>
  <td>
    <input type="text"
      class="form-control"
      name="notes_<%= s._id %>"
      value="<%= s.notes ?? '' %>">
  </td>
</tr>
<% }) %>
</tbody>
</table>
</div>

<button class="btn btn-success">حفظ الدرجات</button>
</form>

</div>
</main>
</div>

<%- include('../../partials/scripts.ejs') %>

<script>
  
const csrfToken = document.getElementById('csrfToken').value;

document.getElementById('gradesForm').addEventListener('submit', async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = {};

  formData.forEach((v,k) => data[k] = v);

  const res = await fetch('', {
    method: 'POST',
    headers: {'Content-Type':'application/json' , 'CSRF-Token': csrfToken },
    body: JSON.stringify(data)
  });

  const result = await res.json();
  alert(result.message);
});
</script>
</body>
</html>
